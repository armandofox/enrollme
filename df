[1mdiff --cc app/controllers/application_controller.rb[m
[1mindex c367d68,00ac50f..0000000[m
[1m--- a/app/controllers/application_controller.rb[m
[1m+++ b/app/controllers/application_controller.rb[m
[36m@@@ -2,16 -2,6 +2,16 @@@[m [mclass ApplicationController < ActionCon[m
    # Prevent CSRF attacks by raising an exception.[m
    # For APIs, you may want to use :null_session instead.[m
    protect_from_forgery with: :exception[m
[31m-   [m
[32m+ [m
[31m -  [m
[32m +  def index[m
[32m +    @user_id = session[:user_id][m
[32m +    @user = User.where(:id => @user_id).first[m
[32m +    [m
[32m +    return redirect_to login_path if @user_id.nil? or @user.nil?[m
[32m +[m
[32m +    return redirect_to without_team_path if @user.team.nil?[m
[32m +[m
[32m +    return redirect_to team_path(:id => @user.team.id)[m
[32m +    [m
[32m +  end[m
  end[m
[1mdiff --cc app/controllers/team_controller.rb[m
[1mindex 5416f51,6a3c24e..0000000[m
[1m--- a/app/controllers/team_controller.rb[m
[1m+++ b/app/controllers/team_controller.rb[m
[36m@@@ -1,27 -1,29 +1,32 @@@[m
  class TeamController < ApplicationController[m
[31m -    [m
    def index[m
[32m+     # TODO: can refactor index and show, also join/leave team in user controller[m
      @user_id = session[:user_id][m
[31m-     return redirect_to login_path if @user_id.nil?[m
[32m+     return redirect_to login_path, :notice => "Please log in" if @user_id.nil?[m
[32m+     [m
[32m+     return redirect_to admin_path(@user_id) if session[:is_admin][m
      [m
[32m +    # @user = User.find_by_id(@user_id)[m
[32m +    # return redirect_to login_path if @user.nil?[m
[32m +    [m
      @user = User.find(@user_id)[m
[32m +    [m
      return redirect_to without_team_path, :notice => "Your team does not exist" if @user.team.nil?[m
  [m
      return redirect_to team_path(:id => @user.team.id)[m
    end[m
[31m -  [m
[32m +[m
    def show[m
[31m-     @team = Team.where(:id => params[:id]).first[m
[31m-     return redirect_to '/', notice: "This team does not exist" if @team.nil?[m
  [m
[31m-     @user_id = session[:user_id][m
[31m-     return redirect_to login_path if @user_id.nil?[m
[32m+     @user = User.find_by_id(session[:user_id])[m
[32m+     return redirect_to login_path, :notice => "Please log in" if @user.nil?[m
[32m+     [m
[32m+     return redirect_to admin_path(@user.id) if session[:is_admin][m
  [m
[31m-     @user = User.find(@user_id)[m
      return redirect_to without_team_path, :notice => "Your team does not exist" if @user.team.nil?[m
[32m+     [m
[32m+     @team = Team.find_by_id(params[:id])[m
[32m+     return redirect_to '/', notice: "This team does not exist" if @team.nil?[m
    [m
      return redirect_to team_path(:id => @user.team.id), notice: "Cannot access this team" if @user.team != @team[m
  [m
[36m@@@ -32,8 -34,10 +37,18 @@@[m
      User.find(session[:user_id]).leave_team[m
      return redirect_to without_team_path[m
    end[m
[32m++<<<<<<< HEAD[m
[32m +[m
[32m +  def update[m
[32m +  end[m
[32m +  [m
[32m +end[m
[32m++=======[m
[32m+   [m
[32m+   # TODO: edit users in the team page (for now, it's just text)[m
[32m+   # but we need to change that to a button + add some kind of form?[m
[32m+   # what were we going to do with that anyway, add/delete?[m
[32m+   # we could just have a "remove" button and some kind of [m
[32m+   # "Are you sure?" thing--can ask MDS what he wants idk[m
[31m -end[m
[32m++end[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
[1mdiff --cc app/controllers/users_controller.rb[m
[1mindex 6973140,5d7971a..0000000[m
[1m--- a/app/controllers/users_controller.rb[m
[1m+++ b/app/controllers/users_controller.rb[m
[36m@@@ -17,27 -17,27 +17,43 @@@[m [mclass UsersController < ApplicationCont[m
        render 'new', :notice => "Form is invalid"[m
      end[m
    end[m
[31m -  [m
[32m +[m
    def edit[m
      @user = User.find session[:user_id][m
[32m++<<<<<<< HEAD[m
[32m +    render "users/edit"[m
[32m++=======[m
[32m+     render 'edit'[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
    end[m
[31m -  [m
[32m +[m
    def without[m
      return redirect_to login_path if session[:user_id].nil?[m
[32m++<<<<<<< HEAD[m
[32m +    render "users/without"[m
[32m++=======[m
[32m+     [m
[32m+     render 'without'[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
    end[m
  [m
    def start_team[m
      @user = User.find(session[:user_id])[m
[32m++<<<<<<< HEAD[m
[32m +    [m
[32m +    @user.leave_team if !(@user.team.nil?)[m
[32m +[m
[32m +    #@team = Team.create!(:passcode => Team.generate_hash, :approved => false)[m
[32m +    @team = Team.create!(:passcode => generate_hash, :approved => false)[m
[32m++=======[m
[32m+     @user.leave_team if !(@user.team.nil?)[m
[32m+     [m
[32m+     @team = Team.create!(:passcode => Team.generate_hash, :approved => false)[m
[32m+ [m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
      @user.team = @team[m
      @team.users << @user[m
[31m-     redirect_to team_path(:id=>@team.id), :notice => "Successfully created a team!"[m
[32m+     redirect_to team_path(:id=>@team.id)[m
    end[m
  [m
    def join_team[m
[1mdiff --cc app/models/user.rb[m
[1mindex 6fae464,d076cd9..0000000[m
[1m--- a/app/models/user.rb[m
[1m+++ b/app/models/user.rb[m
[36m@@@ -6,12 -4,14 +6,13 @@@[m [mclass User < ActiveRecord::Bas[m
    validates :name, presence: true, length: { maximum: 50 }[m
    VALID_EMAIL_REGEX = /\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i[m
    validates :email, presence: true, uniqueness: true, length: { maximum: 50 }, format: VALID_EMAIL_REGEX[m
[31m -  validates :major, presence: true, length: { maximum: 50 }[m
    validates :sid, presence: true, uniqueness: true, length: { maximum: 10 }[m
[31m-   validates :password, presence: true, length: {maximum: 50 }[m
[32m+   validates :password, presence: true, length: { maximum: 50 }[m
    [m
[31m-   #has_secure_password[m
[31m-   [m
[31m-     [m
[31m-   [m
[31m-     [m
[32m+   def leave_team[m
[32m+     @team = self.team[m
[32m+     @team.users.delete(self)[m
[32m+     self.team = nil[m
[32m+   end[m
[32m+ [m
  end[m
[1mdiff --cc app/views/session/new.html.erb[m
[1mindex 1320783,b401654..0000000[m
[1m--- a/app/views/session/new.html.erb[m
[1m+++ b/app/views/session/new.html.erb[m
[36m@@@ -1,6 -1,5 +1,9 @@@[m
  <html>[m
  <head>[m
[32m++<<<<<<< HEAD[m
[32m +  <%= yield %>[m
[32m++=======[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
    <title>Login</title>[m
  [m
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>[m
[36m@@@ -28,8 -27,12 +31,17 @@@[m
                  [m
                  <div class="actions">[m
                      <%= submit_tag "Log In", class: "btn btn-primary" %>[m
[32m++<<<<<<< HEAD[m
[32m +                    <a href=signup class="btn btn-default">Sign up</a>[m
[32m +                </div>[m
[32m++=======[m
[32m+                     <a href='users/new' class="btn btn-default">Sign up</a>[m
[32m+                     <br>[m
[32m+                     <br>[m
[32m+                     <a href='admins/new' class="btn btn-default">Admin Sign up</a>[m
[32m+                 </div>[m
[32m+ [m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
              <% end %>[m
          </div>[m
      </div>[m
[1mdiff --cc app/views/team/index.html.erb[m
[1mindex b1ecd3b,dd8704f..0000000[m
[1m--- a/app/views/team/index.html.erb[m
[1m+++ b/app/views/team/index.html.erb[m
[36m@@@ -1,54 -1,19 +1,73 @@@[m
[32m++<<<<<<< HEAD:app/views/team/index.html.erb[m
[32m +<html>[m
[32m +<head>[m
[32m +  <%= yield %>[m
[32m +  <title>EnrollMe</title>[m
[32m +  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>[m
[32m +  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>[m
[32m +  <%= csrf_meta_tags %>[m
[32m +</head>[m
[32m +<body>[m
[32m +  [m
[32m +    <div class="container">[m
[32m +      [m
[32m +      <h1>My Team</h1>[m
[32m +      <h3><%=  "Team Password: " + @team.passcode.to_s %></h3>[m
[32m +      [m
[32m +      <div class="row">[m
[32m +        <div class="col-md-8">[m
[32m +          <h2>Members</h2>[m
[32m +          <table class="table table-striped table-hover">[m
[32m +            <tr>[m
[32m +                <td></td>[m
[32m +                <td>Student</td>[m
[32m +                <td>CS Major?</td>[m
[32m +                <td></td>[m
[32m +              </tr>[m
[32m +              [m
[32m +            [m
[32m +            <% Team.find(@team.id).users.each do |u| %>[m
[32m +              <tr>[m
[32m +                <td><%= u.name %></td>[m
[32m +                <td><%= u.major == "Computer Science" or u.major == "Electrical Engineering and Computer Science" ? "â€¢" : "No" %></td>[m
[32m +                <td>Edit</td>[m
[32m +              </tr>[m
[32m +            <% end %>[m
[32m +          </table>[m
[32m +        </div>[m
[32m +        <div class="col-md-4">[m
[32m +          <a href="http://eecs.jimren.com/" class="btn btn-primary">CS 169 Enrollment</a>[m
[32m +       </div>[m
[32m +      </div>[m
[32m +      <div class="actions">[m
[32m +        <div class="col-xs-2">[m
[32m +          <%= submit_tag "Submit changes", class: "btn btn-primary" %>[m
[32m +        </div>[m
[32m +        [m
[32m +        <div class="col-xs-2">[m
[32m +          <%= form_tag leave_team_path do %>[m
[32m +            <%= submit_tag "Leave team", class: "btn btn-default" %>[m
[32m +          <% end %>[m
[32m +        </div>[m
[32m +      </div>[m
[32m++=======[m
[32m+ <body>[m
[32m+   <% flash.each do |name, msg| %>[m
[32m+     <%= content_tag :div, msg, class: "alert alert-info" %>[m
[32m+   <% end %>[m
[32m+   <div class="container">[m
[32m+     <br>[m
[32m+     <br>[m
[32m+     <br>[m
[32m+     <div class="col-xs-2">[m
[32m+       <%= button_to "Edit My Info", edit_user_path(session[:user_id]), {method: 'get', class: "btn btn-primary"} %>[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9:app/views/layouts/team.html.erb[m
[32m+     </div>[m
[32m+     <div class="col-xs-2">[m
[32m+       <%= button_to "Logout", logout_path, class: "btn btn-default" %>[m
[32m+     </div>[m
      </div>[m
[32m+   </div>[m
  </body>[m
[31m- </html>[m
[32m+ [m
[32m+ <%= yield %>[m
[1mdiff --cc app/views/users/edit.html.erb[m
[1mindex 1357422,fc4f9b9..0000000[m
[1m--- a/app/views/users/edit.html.erb[m
[1m+++ b/app/views/users/edit.html.erb[m
[36m@@@ -1,8 -1,12 +1,20 @@@[m
[32m++<<<<<<< HEAD[m
[32m +<html>[m
[32m +<head>[m
[32m +  <%= yield %>[m
[32m +  <title>Edit Info</title>[m
[32m +[m
[32m++=======[m
[32m+ <div class="col-xs-2">[m
[32m+   <%= button_to "Logout", logout_path, class: "btn btn-default" %>[m
[32m+ </div>[m
[32m+ [m
[32m+ <html>[m
[32m+ <head>[m
[32m+   <%= yield %>[m
[32m+   <title>Edit Info</title>[m
[32m+ [m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>[m
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>[m
    <%= csrf_meta_tags %>[m
[1mdiff --cc app/views/users/new.html.erb[m
[1mindex 53488a9,9dfaf46..0000000[m
[1m--- a/app/views/users/new.html.erb[m
[1m+++ b/app/views/users/new.html.erb[m
[36m@@@ -1,7 -1,6 +1,11 @@@[m
  <html>[m
  <head>[m
[32m++<<<<<<< HEAD[m
[32m +  <%= yield %>[m
[32m +  <title>Login</title>[m
[32m++=======[m
[32m+   <title>Sign up</title>[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
  [m
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>[m
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>[m
[36m@@@ -9,7 -8,7 +13,11 @@@[m
  </head>[m
  <body>[m
      <div class="container">[m
[32m++<<<<<<< HEAD[m
[32m +        [m
[32m++=======[m
[32m+         <%= yield %>[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
          <h1>Sign Up</h1>[m
          <%= form_for @user, url: {action: "create"}, class: "form-horizontal" do |f| %>[m
              <fieldset>[m
[36m@@@ -40,8 -39,8 +48,13 @@@[m
                  </div>[m
                  [m
                  <div class="field form-group">[m
[32m++<<<<<<< HEAD[m
[32m +                  <%= f.label :major %> <br>[m
[32m +                  <%= f.collection_select :major, User::MAJOR, :to_s, :to_s, :include_blank => false %>[m
[32m++=======[m
[32m+                     <%= f.label :major, class: "col-lg-2 control-label" %> <br>[m
[32m+                     <%= f.text_field :major, placeholder: "Computer Science", class: "form-control" %>[m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
                  </div>[m
                  [m
                  <br>[m
[1mdiff --cc app/views/users/without.html.erb[m
[1mindex 55d3de4,7802b6b..0000000[m
[1m--- a/app/views/users/without.html.erb[m
[1m+++ b/app/views/users/without.html.erb[m
[36m@@@ -1,4 -1,10 +1,14 @@@[m
[32m++<<<<<<< HEAD[m
[32m +<html>[m
[32m++=======[m
[32m+ [m
[32m+ <div class="container">[m
[32m+     <%= button_to "Logout", logout_path, class: "btn btn-default" %>[m
[32m+ </div>[m
[32m+     [m
[32m+ <html>[m
[32m+ [m
[32m++>>>>>>> 6d813ac32741c464680186784b1cb3c8d01712b9[m
  <head>[m
    <%= yield %>[m
    <title>EnrollMe</title>[m
[1mdiff --cc config/routes.rb[m
[1mindex b44aaba,fb996fe..0000000[m
[1m--- a/config/routes.rb[m
[1m+++ b/config/routes.rb[m
[36m@@@ -1,32 -1,15 +1,35 @@@[m
  Rails.application.routes.draw do[m
  [m
[32m +  # get 'session/new'[m
[32m +  # get 'session/create'[m
[32m +  # get 'session/destroy'[m
[32m +[m
[32m +  # get 'team/index'[m
[32m +  # get 'team/show'[m
[32m +  # get 'team/leave'[m
[32m +  # get 'team/update'[m
[32m +[m
[32m +  # get 'users/new'[m
[32m +  # get 'users/create'[m
[32m +  # get 'users/edit'[m
[32m +  # get 'users/without'[m
[32m +  # get 'users/start_team'[m
[32m +  # get 'users/join_team'[m
[32m +  # get 'users/update'[m
[32m +[m
[32m +  get '/signup', to: 'users#new'[m
[32m +  post '/signup', to: 'users#new'[m
[32m +  [m
[32m+   get '/', to: redirect('/login')[m
[31m -[m
[32m++  [m
    resources :users[m
[31m-   resources :team[m
[32m+   get '/without_team', to: 'users#without'[m
[32m+   post '/create_team', to: 'users#start_team'[m
[32m+   post '/join_team', to: 'users#join_team'[m
    [m
[32m+   resources :team[m
    post 'leave_team', to: 'team#leave'[m
    [m
[31m-   # TODO: something for route not found[m
[31m-   [m
    get 'login', to: 'session#new'[m
    post 'login', to: 'session#create'[m
    post 'logout', to: 'session#destroy'[m
* Unmerged path app/views/layouts/session.html.erb
* Unmerged path app/views/layouts/users.html.erb
